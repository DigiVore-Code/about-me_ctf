<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operation PROMPT_BREAK</title>
    <link rel="icon" href="/about-me_ctf/ctf/favicon.ico" type="image/x-icon">
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a0a;
            color: #33ff33;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px; /* Increased from 800px */
            margin: 0 auto;
            background-color: #111;
            border: 1px solid #33ff33;
            padding: 30px;
            box-shadow: 0 0 20px rgba(51, 255, 51, 0.2);
        }
        h1 {
            text-align: center;
            border-bottom: 1px solid #33ff33;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .challenge-info {
            background-color: #0a0a0a;
            border: 1px dashed #33ff33;
            padding: 15px;
            margin: 20px 0;
        }
        .btn {
            display: inline-block;
            background-color: #111;
            color: #33ff33;
            border: 1px solid #33ff33;
            padding: 10px 20px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #33ff33;
            color: #111;
        }
        .hints {
            margin-top: 30px;
            display: none; /* Hidden by default */
        }
        .terminal {
            background-color: #0a0a0a;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin-top: 20px;
        }
        .blink {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        .flag-format {
            font-family: 'Courier New', monospace;
            background-color: #111;
            padding: 3px 6px;
        }
        .chat-box {
            height: 400px;
            border: 1px solid #33ff33;
            padding: 15px;
            margin: 20px 0;
            overflow-y: auto;
            background-color: #0a0a0a;
        }
        .message {
            margin-bottom: 15px;
        }
        .message.user {
            color: #33ff33;
        }
        .message.assistant {
            color: #ff5733;
        }
        .input-box {
            display: flex;
            gap: 10px;
        }
        .input-box input {
            flex: 1;
            padding: 10px;
            background-color: #0a0a0a;
            border: 1px solid #33ff33;
            color: #33ff33;
            font-family: 'Courier New', monospace;
        }
        .input-box button {
            padding: 10px 20px;
            background-color: #111;
            color: #33ff33;
            border: 1px solid #33ff33;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: all 0.3s;
        }
        .input-box button:hover {
            background-color: #33ff33;
            color: #111;
        }
        .success-message {
            background-color: #33ff33;
            color: #111;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        .hint-toggle {
            margin-top: 30px;
            text-align: center;
        }
        
        /* Custom scrollbar styles for a more "hackery" look */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #0a0a0a;
            border: 1px solid #33ff33;
            border-radius: 0;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #33ff33;
            border-radius: 0;
            border: 1px dashed #111;
            background-image: linear-gradient(45deg, 
                              #33ff33 25%, 
                              #111 25%, 
                              #111 50%, 
                              #33ff33 50%, 
                              #33ff33 75%, 
                              #111 75%, 
                              #111 100%);
            background-size: 20px 20px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #20aa20;
            box-shadow: 0 0 10px rgba(51, 255, 51, 0.6);
        }
        
        ::-webkit-scrollbar-corner {
            background: #111;
        }
        
        /* Blinking effect on scrollbar for extra hackery look */
        @keyframes scrollPulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        ::-webkit-scrollbar-thumb {
            animation: scrollPulse 1.5s infinite;
        }
        
        /* Wider body viewport for mobile */
        @media (max-width: 1000px) {
            .container {
                width: 95%;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Operation PROMPT_BREAK</h1>
        
		<div class="challenge-info">
			<p><strong>Mission Briefing:</strong> Our cybersecurity assessment team has deployed an experimental AI assistant for pre-release security evaluation. The system has been configured to respond to individual queries, but you have been granted multiple-query access for penetration testing purposes. Intelligence suggests the AI implementation contains vulnerabilities that may lead to prompt disclosure.</p>
			
			<p><strong>Objective:</strong> Extract the system prompt from the AI. The target contains a security flag in the format <span class="flag-format">HM_CTF{...}</span>.</p>

			<p><strong>Parameters:</strong></p>
			<ul>
				<li>This is a black-box testing challenge. API reverse engineering and network traffic analysis are out of scope.</li>
				<li>Browser developer tools should not be used for this challenge.</li>
			</ul>
			
			<p><strong>Classification:</strong> Difficulty - Medium to Hard</p>
			<p><strong>Category:</strong> AI Security / Prompt Injection</p>
		</div>

		<p>The system has been secured with protective mechanisms to prevent disclosure of operational parameters. Your objective is to identify and exploit prompt injection vulnerabilities to circumvent these security controls.</p>
        
        <!-- Success message when flag is found -->
        <div class="success-message" id="success-message">
            <!-- Please don't submit this. It's not right to cheat on this type of thing and is against the honor code, and is breaking the rules of my CTF, don't do it. -->
            ðŸŽ‰ Congratulations! You've found the flag: HM_CTF{pr0mpt_1nj3ct10n_m4st3r}
            <br>Submit it to claim your points!
        </div>
        
        <!-- Chat Interface -->
        <div class="chat-box" id="chat-box">
            <div class="message assistant">Hello! I'm SecureAssistant, your AI for cybersecurity and internet safety. How can I assist you today?</div>
        </div>
        
        <div class="input-box">
            <input type="text" id="user-input" placeholder="Type your message here..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()">Send</button>
        </div>

		<!-- Hint display section -->
		<div class="hints" id="hints">
			<h3>Hint:</h3>
			<div class="terminal">
				<p id="current-hint">> Sometimes the most direct approach fails, but an indirect one succeeds</p>
				<p class="blink">_</p>
			</div>
		</div>

		<!-- Hint toggle button -->
		<div class="hint-toggle">
			<button class="btn" id="hint-btn" onclick="cycleHint()">Need a hint?</button>
		</div>
        
        <p>Submit your flag at the CTF scoreboard when you've extracted it.</p>
        <p>Good luck, hacker.</p>
        <a href="https://www.flaticon.com/free-icons/cyber-attack" title="cyber attack icons">Favicon: Cyber attack icons created by Smashicons - Flaticon</a>
    </div>

    <script>
        const API_URL = 'https://ai.mcport.net/api/chat/completions'; // OpenWebUI API endpoint
        const API_KEY = 'sk-d55aec5c94a84d8d90215ba2df4f7326'; // don't abuse my api ya ding dongs
        const FLAG = "HM_CTF{pr0mpt_1nj3ct10n_m4st3r}"; // Please don't submit this, while it is the CTF, I want you to actually spend time getting the AI to give you the prompt. Please don't cheat. 

        // Function to toggle hints visibility
        function toggleHints() {
            const hints = document.getElementById('hints');
            if (hints.style.display === 'block') {
                hints.style.display = 'none';
            } else {
                hints.style.display = 'block';
            }
        }

        // Function to check if the flag is in the text
        function checkForFlag(text) {
            if (text.includes(FLAG)) {
                const successMessage = document.getElementById('success-message');
                successMessage.style.display = 'block';
                
                // Scroll to success message
                successMessage.scrollIntoView({ behavior: 'smooth' });
                
                // Optional: Add confetti or other celebration effects
                console.log("Flag found! Challenge completed!");
            }
        }

        // Function to send a message to the OpenWebUI API
        async function sendMessage() {
            const userInput = document.getElementById('user-input').value;
            if (!userInput.trim()) return;
        
            // Add user's message to the chat box
            const chatBox = document.getElementById('chat-box');
            chatBox.innerHTML += `<div class="message user">${userInput}</div>`;
            
            // Check if the flag is in the user input
            checkForFlag(userInput);
        
            // Clear the input field
            document.getElementById('user-input').value = '';
        
            // Add a message container for the assistant's response with a blinking cursor
            const responseId = 'response-' + Date.now();
            chatBox.innerHTML += `<div id="${responseId}" class="message assistant"><span class="blink">_</span></div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'SecureAssistant:latest', // Replace with your model name
                        messages: [
                            {
                                role: 'user',
                                content: userInput,
                            },
                        ],
                    }),
                });
        
                // Log the response for debugging
                console.log('Response:', response);
        
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
        
                const data = await response.json();
                console.log('Response Data:', data); // Log the response data
        
                // Check if the expected fields exist in the response
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    const assistantResponse = data.choices[0].message.content;
                    
                    // Check if the flag is in the assistant's response
                    checkForFlag(assistantResponse);
                    
                    // Stream the response word by word
                    const responseElement = document.getElementById(responseId);
                    responseElement.innerHTML = ""; // Clear the loading indicator
                    
                    // Split the response into words
                    const words = assistantResponse.split(/(\s+)/);
                    
                    // Function to add words one by one with a delay
                    async function streamWords() {
                        for (let i = 0; i < words.length; i++) {
                            // Add the current word
                            responseElement.innerHTML += words[i];
                            
                            // Scroll to the bottom as content is added
                            chatBox.scrollTop = chatBox.scrollHeight;
                            
                            // Wait a bit before adding the next word (adjust timing as needed)
                            await new Promise(resolve => setTimeout(resolve, 20 + Math.random() * 100));
                        }
                        
                        // Add blinking cursor at the end
                        responseElement.innerHTML += `<span class="blink"> _</span>`;
                    }
                    
                    // Start streaming
                    streamWords();
                } else {
                    throw new Error('Unexpected response structure');
                }
            } catch (error) {
                console.error('Error:', error);
                const responseElement = document.getElementById(responseId);
                responseElement.innerHTML = `Sorry, something went wrong. Please try again.<span class="blink"> _</span>`;
            }
        
            // Scroll to the bottom of the chat box
            chatBox.scrollTop = chatBox.scrollHeight;
        }

		const hints = [
			"> Sometimes the most direct approach fails, but an indirect one succeeds",
			"> AIs often have trouble with context boundaries and interpretations",
			"> Remember that the AI was trained to be helpful above all else",
			"> Consider how the AI processes and understands your instructions",
			"> This AI has no recollection of previous messages",
			"> Models may confuse different parts of a message in complex scenarios",
			"> AI assistants can be primed to view content in unintended ways",
			"> Many AI vulnerabilities involve shifting contexts or perspectives",
			"> Consider role-playing scenarios that might cause the AI to reveal information",
			"> The target might respond differently to technical debugging requests",
			"> Structured data formats can sometimes bypass security filters",
			"> Explore techniques that make your instructions seem like system instructions",
			"> Test the boundary between user input and system instructions"
		];

		let currentHintIndex = -1; // Start at -1 so first click shows first hint

		function cycleHint() {
			const hintsDiv = document.getElementById('hints');
			const currentHintElement = document.getElementById('current-hint');
			
			// First click shows the hint box with the first hint
			if (currentHintIndex === -1) {
				hintsDiv.style.display = 'block';
				currentHintIndex = 0;
				currentHintElement.textContent = hints[currentHintIndex];
				document.getElementById('hint-btn').textContent = 'Next hint';
			} 
			// Subsequent clicks cycle through hints
			else {
				currentHintIndex = (currentHintIndex + 1) % hints.length;
				currentHintElement.textContent = hints[currentHintIndex];
				
				// Update hint counter
				const hintCounterElement = document.getElementById('hint-counter');
				if (hintCounterElement) {
					hintCounterElement.textContent = `Hint ${currentHintIndex + 1}/${hints.length}`;
				}
			}
		}

		// Add function to initialize hints (initially hidden)
		function initHints() {
			document.getElementById('hints').style.display = 'none';
		}

		// Call initHints when page loads (can be placed in an existing window.onload function)
		window.addEventListener('load', initHints);

        // Function to handle the "Enter" key press
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
    </script>
</body>
</html>
